<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PetWise Pro - 寵物批發管理系統</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ea580c">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        html, body {
            height: 100%;
            overflow: hidden;
            background-color: #f8fafc;
            margin: 0;
            padding: 0;
            position: fixed;
            width: 100%;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        #root {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .scroll-container {
            flex: 1;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 120px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input, select, textarea { font-size: 16px !important; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.3",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "vite": "https://esm.sh/vite@^7.3.1",
    "@vitejs/plugin-react": "https://esm.sh/@vitejs/plugin-react@^5.1.2"
  }
}
</script>
</head>
<body>
    <div id="root"></div>
    <script type="module">
import React, { useState, useEffect, useMemo } from 'react';
import ReactDOM from 'react-dom/client';
import { 
    ShoppingCart, History, Package, Plus, Trash2, Search, 
    LayoutGrid, ClipboardCheck, LogOut, ShieldCheck, 
    Smartphone, Save, X, ChevronDown, User, Lock, Mail, FileSpreadsheet, Camera, CreditCard, Send, Minus, Settings, BellRing
} from 'lucide-react';

// --- 常數設定 ---
const ADMIN_PASSWORD = '0000';
const STORAGE_KEY = 'petwise_pro_v9_stable';
const BANK_INFO = {
    code: '009 (彰化銀行)',
    account: '55128601245100'
};

// --- 初始商品清單 ---
const INITIAL_PRODUCTS = [
    { id: 'd1', category: '風乾零食', name: '貓咪抗拒不了貓草餅乾', variant: '預設', wholesalePrice: 163, retailPrice: 250, stock: 100, onShelfCount: 20 },
    { id: 'd2', category: '風乾零食', name: '無雞不可，經典雞胸肉乾', variant: '預設', wholesalePrice: 163, retailPrice: 250, stock: 100, onShelfCount: 20 },
    { id: 'd3', category: '風乾零食', name: '一比一比鴨鴨鴨胸肉乾', variant: '預設', wholesalePrice: 195, retailPrice: 300, stock: 100, onShelfCount: 20 },
    { id: 'f1', category: '凍乾零食', name: '嗷嗚原形脆，雞小方', variant: '預設', wholesalePrice: 163, retailPrice: 250, stock: 80, onShelfCount: 15 },
    { id: 'u1', category: '用品', name: '狗狗慢食墊', variant: '蜜桃粉', wholesalePrice: 200, retailPrice: 310, stock: 50, onShelfCount: 10 },
];

const App = () => {
    const [view, setView] = useState('auth'); 
    const [isRegistering, setIsRegistering] = useState(false);
    const [userRole, setUserRole] = useState(null);
    const [products, setProducts] = useState([]);
    const [cart, setCart] = useState([]);
    const [orders, setOrders] = useState([]);
    const [users, setUsers] = useState([]);
    const [lineConfig, setLineConfig] = useState({ channelToken: '', notifyUserId: '' });

    const [searchQuery, setSearchQuery] = useState('');
    const [activeCategory, setActiveCategory] = useState('All');
    const [editModal, setEditModal] = useState(null);
    const [authInput, setAuthInput] = useState({ username: '', password: '' });
    const [orderQuantities, setOrderQuantities] = useState({});

    const [checkoutForm, setCheckoutForm] = useState({
        date: new Date().toISOString().split('T')[0],
        companyName: '',
        customerName: '',
        phone: '',
        address: '',
        taxTitle: '',
        taxId: '',
        deliveryTime: '不指定',
        remarks: '',
        transferLastFive: '',
        hasScreenshot: false
    });

    useEffect(() => {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
            try {
                const parsed = JSON.parse(saved);
                setProducts(parsed.products || INITIAL_PRODUCTS);
                setOrders(parsed.orders || []);
                setUsers(parsed.users || []);
                setLineConfig(parsed.lineConfig || { channelToken: '', notifyUserId: '' });
            } catch (e) { setProducts(INITIAL_PRODUCTS); }
        } else {
            setProducts(INITIAL_PRODUCTS);
        }
    }, []);

    useEffect(() => {
        localStorage.setItem(STORAGE_KEY, JSON.stringify({ products, orders, users, lineConfig }));
    }, [products, orders, users, lineConfig]);

    const categories = useMemo(() => ['All', ...Array.from(new Set(products.map(p => p.category)))], [products]);
    const cartTotal = cart.reduce((sum, item) => sum + item.wholesalePrice * item.quantity, 0);

    const handleAuth = (e) => {
        e.preventDefault();
        if (isRegistering) {
            if (users.find(u => u.username === authInput.username)) return alert('此帳號已存在');
            setUsers([...users, { ...authInput }]);
            alert('註冊成功！請登入');
            setIsRegistering(false);
        } else {
            if (authInput.password === ADMIN_PASSWORD) {
                setUserRole('admin');
                setView('inventory');
            } else {
                const user = users.find(u => u.username === authInput.username && u.password === authInput.password);
                if (user) {
                    setUserRole('customer');
                    setView('order');
                } else {
                    alert('帳號或密碼錯誤');
                }
            }
        }
    };

    const addToCart = (product) => {
        const qty = orderQuantities[product.id] || 1;
        setCart(prev => {
            const existing = prev.find(item => item.id === product.id);
            if (existing) return prev.map(item => item.id === product.id ? { ...item, quantity: item.quantity + qty } : item);
            return [...prev, { ...product, quantity: qty }];
        });
        setOrderQuantities(prev => ({ ...prev, [product.id]: 1 }));
        alert(`已加入購物車！`);
    };

    const submitOrder = () => {
        if (!checkoutForm.customerName || !checkoutForm.phone || !checkoutForm.transferLastFive) {
            alert('請完整填寫收件人與匯款後五碼！');
            return;
        }

        const newOrder = {
            id: `PW-${Date.now().toString().slice(-6)}`,
            ...checkoutForm,
            items: [...cart],
            totalAmount: cartTotal,
            status: '處理中'
        };

        setProducts(prev => prev.map(p => {
            const item = cart.find(ci => ci.id === p.id);
            return item ? { ...p, stock: p.stock - item.quantity, onShelfCount: p.onShelfCount - item.quantity } : p;
        }));

        setOrders([newOrder, ...orders]);
        
        if (lineConfig.channelToken) {
            console.log("模擬發送 LINE 通知至:", lineConfig.notifyUserId);
            alert("【LINE 通知】訂單已同步至官方帳號後台");
        }

        setCart([]);
        setView('history');
        alert('下單成功！感謝您的訂購。');
    };

    const exportCSV = (order) => {
        const groupedItems = {};
        order.items.forEach((item) => {
            if (!groupedItems[item.category]) groupedItems[item.category] = [];
            groupedItems[item.category].push(item);
        });

        let csvRows = [
            `報表日期,${order.date}`,
            `公司名稱,${order.companyName || '個人'}`,
            '',
            '客戶姓名,聯絡電話,收貨地址,匯款五碼,總計金額',
            `"${order.customerName}","${order.phone}","${order.address}","${order.transferLastFive}",${order.totalAmount}`,
            ''
        ];

        Object.keys(groupedItems).forEach(cat => {
            csvRows.push(`--- 分類：${cat} ---`);
            csvRows.push('品名,規格,批價,數量,小計');
            groupedItems[cat].forEach(i => {
                csvRows.push(`"${i.name}","${i.variant}",${i.wholesalePrice},${i.quantity},${i.wholesalePrice * i.quantity}`);
            });
            csvRows.push('');
        });

        const blob = new Blob(["\uFEFF" + csvRows.join('\n')], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement('a');
        link.href = URL.createObjectURL(blob);
        link.download = `訂單報表_${order.customerName}_${order.date}.csv`;
        link.click();
    };

    if (view === 'auth') return (
        <div className="h-full flex flex-col items-center justify-center p-8 bg-slate-50">
            <div className="w-full max-w-sm bg-white p-10 rounded-[3rem] shadow-2xl space-y-8 border-2 border-slate-200">
                <div className="text-center">
                    <div className="w-20 h-20 bg-orange-600 rounded-3xl flex items-center justify-center mx-auto shadow-xl mb-4 text-white">
                        <Smartphone size={40} />
                    </div>
                    <h1 className="text-3xl font-black text-slate-900 tracking-tighter italic">PetWise Pro</h1>
                    <p className="text-xs text-slate-500 font-bold uppercase mt-2">{isRegistering ? '新客戶註冊' : '會員系統登入'}</p>
                </div>
                <form className="space-y-4" onSubmit={handleAuth}>
                    <input className="w-full p-4 bg-slate-50 border-2 border-slate-200 rounded-2xl font-bold text-slate-900 outline-none focus:border-orange-500" placeholder="帳號名稱" value={authInput.username} onChange={e=>setAuthInput({...authInput, username:e.target.value})} required />
                    <input className="w-full p-4 bg-slate-50 border-2 border-slate-200 rounded-2xl font-bold text-slate-900 outline-none focus:border-orange-500" placeholder="密碼" type="password" value={authInput.password} onChange={e=>setAuthInput({...authInput, password:e.target.value})} required />
                    <button type="submit" className="w-full py-5 bg-orange-600 text-white rounded-[2rem] font-black text-xl shadow-xl active:scale-95 transition-all">
                        {isRegistering ? '註冊帳號' : '進入系統'}
                    </button>
                </form>
                <div className="text-center">
                    <button onClick={()=>setIsRegistering(!isRegistering)} className="text-xs font-black text-slate-400 hover:text-orange-600 tracking-widest uppercase">
                        {isRegistering ? '已有帳號？返回登入' : '第一次使用？點此註冊'}
                    </button>
                </div>
            </div>
        </div>
    );

    return (
        <div className="flex flex-col h-full bg-slate-100 font-sans text-slate-900 overflow-hidden">
            <header className="bg-white px-6 py-4 flex justify-between items-center shadow-md z-50 pt-12 border-b-2 border-slate-200 shrink-0">
                <div className="flex items-center gap-2">
                    <ShieldCheck className="text-orange-600 w-7 h-7" />
                    <h1 className="font-black text-2xl text-slate-900 tracking-tighter italic">PetWise</h1>
                </div>
                {userRole === 'admin' && <div className="px-3 py-1 bg-slate-900 text-white text-[9px] font-black rounded-full uppercase">Admin</div>}
                {userRole === 'customer' && cart.length > 0 && view !== 'checkout' && (
                    <button onClick={() => setView('cart')} className="relative p-2.5 bg-orange-50 text-orange-600 rounded-2xl">
                        <ShoppingCart className="w-5 h-5" />
                        <span className="absolute -top-1 -right-1 bg-red-600 text-white text-[10px] w-5 h-5 rounded-full flex items-center justify-center font-bold border-2 border-white">{cart.length}</span>
                    </button>
                )}
            </header>

            <main className="flex-1 relative overflow-hidden">
                {view === 'order' && userRole === 'customer' && (
                    <div className="scroll-container p-4 space-y-4">
                        <div className="bg-white p-4 rounded-3xl border-2 border-slate-200 shadow-sm flex items-center gap-3">
                            <Search className="text-slate-400 w-5 h-5" />
                            <input className="flex-1 bg-transparent font-bold outline-none text-slate-900 text-sm" placeholder="搜尋想要的產品..." value={searchQuery} onChange={e=>setSearchQuery(e.target.value)} />
                        </div>
                        <div className="flex gap-2 overflow-x-auto no-scrollbar py-1">
                            {categories.map(cat => (
                                <button key={cat} onClick={()=>setActiveCategory(cat)} className={`px-5 py-2.5 rounded-full text-[10px] font-black whitespace-nowrap uppercase tracking-widest border-2 transition-all ${activeCategory === cat ? 'bg-orange-600 text-white border-orange-600' : 'bg-white text-slate-500 border-slate-200'}`}>{cat === 'All' ? '全部' : cat}</button>
                            ))}
                        </div>
                        <div className="grid gap-4 pb-32">
                            {products.filter(p => (activeCategory === 'All' || p.category === activeCategory) && p.name.includes(searchQuery)).map(p => (
                                <div key={p.id} className="bg-white p-6 rounded-[2.5rem] border-2 border-slate-200 shadow-md space-y-4">
                                    <div className="flex justify-between items-start">
                                        <div className="flex-1">
                                            <p className="text-[9px] font-black text-orange-600 uppercase mb-1">{p.category}</p>
                                            <h3 className="font-bold text-slate-900 text-base leading-tight">{p.name}</h3>
                                            <p className="text-xs text-slate-400 font-bold mt-1">{p.variant} | 架上: {p.onShelfCount}</p>
                                        </div>
                                        <div className="text-right">
                                            <p className="text-[10px] font-black text-slate-400 uppercase">批價</p>
                                            <p className="text-xl font-black text-slate-900">${p.wholesalePrice}</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-3 pt-2">
                                        <div className="flex items-center bg-slate-50 border-2 border-slate-200 rounded-full px-2 py-1 flex-1 justify-between">
                                            <button onClick={() => setOrderQuantities({...orderQuantities, [p.id]: Math.max(1, (orderQuantities[p.id] || 1) - 1)})} className="w-8 h-8 flex items-center justify-center text-slate-600"><Minus size={16} /></button>
                                            <span className="font-black text-slate-900 text-base">{orderQuantities[p.id] || 1}</span>
                                            <button onClick={() => setOrderQuantities({...orderQuantities, [p.id]: (orderQuantities[p.id] || 1) + 1})} className="w-8 h-8 flex items-center justify-center text-slate-600"><Plus size={16} /></button>
                                        </div>
                                        <button onClick={()=>addToCart(p)} className="flex-[1.5] py-3.5 bg-slate-900 text-white rounded-full font-black text-xs flex items-center justify-center gap-2 shadow-lg active:scale-95 transition-all">
                                            加入購物車
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {view === 'inventory' && userRole === 'admin' && (
                    <div className="scroll-container p-4 space-y-4">
                        <div className="flex justify-between items-center px-2">
                            <h2 className="text-2xl font-black text-slate-900 italic tracking-tighter">盤點中心</h2>
                            <button onClick={()=>setEditModal({id: `new-${Date.now()}`, category: '新分類', name: '', variant: '預設', wholesalePrice: 0, retailPrice: 0, stock: 0, onShelfCount: 0})} className="p-3 bg-slate-900 text-white rounded-xl"><Plus /></button>
                        </div>
                        {products.map(p => (
                            <div key={p.id} onClick={()=>setEditModal(p)} className="bg-white p-5 rounded-[2rem] border-2 border-slate-200 shadow-sm border-l-8 border-l-orange-500 flex justify-between items-center transition-transform active:scale-[0.98]">
                                <div>
                                    <h3 className="font-bold text-slate-900 text-sm leading-tight">{p.name}</h3>
                                    <div className="flex gap-4 mt-2 text-[10px] font-black uppercase text-slate-400">
                                        <span>批價: <span className="text-orange-600">${p.wholesalePrice}</span></span>
                                        <span>零售: ${p.retailPrice}</span>
                                    </div>
                                </div>
                                <div className="text-right shrink-0">
                                    <p className="text-[10px] font-black text-slate-400">總庫 / 架上</p>
                                    <p className="text-lg font-black text-slate-900">{p.stock} / <span className="text-orange-600">{p.onShelfCount}</span></p>
                                </div>
                            </div>
                        ))}
                    </div>
                )}

                {view === 'line-settings' && userRole === 'admin' && (
                    <div className="scroll-container p-6 space-y-6">
                        <div className="flex items-center gap-3">
                            <BellRing className="text-orange-600 w-8 h-8" />
                            <h2 className="text-2xl font-black text-slate-900 italic tracking-tighter">LINE API 設定</h2>
                        </div>
                        <div className="bg-white p-8 rounded-[3rem] border-2 border-slate-200 shadow-xl space-y-6">
                            <div className="space-y-1">
                                <label className="text-[11px] font-black text-slate-500 ml-2 uppercase">Channel Access Token</label>
                                <textarea className="w-full p-4 bg-slate-50 border-2 border-slate-200 rounded-2xl font-mono text-xs h-24" value={lineConfig.channelToken} onChange={e=>setLineConfig({...lineConfig, channelToken: e.target.value})} />
                            </div>
                            <div className="space-y-1">
                                <label className="text-[11px] font-black text-slate-500 ml-2 uppercase">Notify User ID</label>
                                <input className="w-full p-4 bg-slate-50 border-2 border-slate-200 rounded-2xl font-mono text-xs" value={lineConfig.notifyUserId} onChange={e=>setLineConfig({...lineConfig, notifyUserId: e.target.value})} />
                            </div>
                            <button onClick={()=>alert("已存檔")} className="w-full py-5 bg-slate-900 text-white rounded-[2rem] font-black text-lg">儲存設定</button>
                        </div>
                    </div>
                )}

                {view === 'cart' && (
                    <div className="scroll-container p-4 space-y-4">
                        <h2 className="text-2xl font-black text-slate-900 tracking-tighter px-2 italic">確認下單清單</h2>
                        {cart.length === 0 ? (
                            <div className="text-center py-32 text-slate-400 font-bold uppercase">您的購物車是空的</div>
                        ) : (
                            <div className="space-y-3 pb-48">
                                {cart.map(item => (
                                    <div key={item.id} className="bg-white p-6 rounded-[2.5rem] border-2 border-slate-200 flex justify-between items-center shadow-md">
                                        <div className="flex-1">
                                            <h3 className="font-bold text-slate-900 text-sm">{item.name}</h3>
                                            <p className="text-xs font-black text-orange-600 mt-1">批價單價: ${item.wholesalePrice}</p>
                                        </div>
                                        <div className="flex items-center bg-slate-100 rounded-full p-1 border-2 border-slate-200">
                                            <button onClick={()=>{
                                                if(item.quantity > 1) setCart(cart.map(i=>i.id===item.id?{...i, quantity:i.quantity-1}:i));
                                                else setCart(cart.filter(i=>i.id!==item.id));
                                            }} className="w-8 h-8 flex items-center justify-center"><Minus size={14}/></button>
                                            <span className="w-10 text-center font-black text-slate-900">{item.quantity}</span>
                                            <button onClick={()=>setCart(cart.map(i=>i.id===item.id?{...i, quantity:i.quantity+1}:i))} className="w-8 h-8 flex items-center justify-center"><Plus size={14}/></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        )}
                        {cart.length > 0 && (
                            <div className="fixed bottom-[110px] left-0 right-0 p-8 bg-white border-t-2 border-slate-100 shadow-2xl rounded-t-[4rem] z-40">
                                <div className="flex justify-between items-center mb-6 px-4">
                                    <span className="font-black text-slate-500 text-sm uppercase">結算金額</span>
                                    <span className="text-4xl font-black text-slate-900">${cartTotal}</span>
                                </div>
                                <button onClick={()=>setView('checkout')} className="w-full bg-orange-600 text-white py-6 rounded-[2.5rem] font-black text-xl shadow-2xl active:scale-95 transition-all">填寫結帳與匯款資料</button>
                            </div>
                        )}
                    </div>
                )}

                {view === 'checkout' && (
                    <div className="scroll-container p-6 space-y-6">
                        <div className="bg-orange-50 p-6 rounded-3xl border-2 border-orange-200 space-y-2">
                            <div className="flex items-center gap-2 text-orange-700 font-black">
                                <CreditCard size={18} />
                                <h3>彰化銀行匯款帳戶 (009)</h3>
                            </div>
                            <p className="text-sm font-black text-orange-600 tracking-widest leading-loose">帳號：55128601245100</p>
                            <p className="text-[10px] text-slate-500 font-bold italic">* 請轉帳後填寫後五碼，以便 LINE 通知查帳</p>
                        </div>
                        <div className="grid gap-4 pb-32">
                            <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" type="date" value={checkoutForm.date} onChange={e=>setCheckoutForm({...checkoutForm, date: e.target.value})} />
                            <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" placeholder="公司名稱 (單獨報表顯示行) *" value={checkoutForm.companyName} onChange={e=>setCheckoutForm({...checkoutForm, companyName: e.target.value})} />
                            <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" placeholder="收件姓名 *" value={checkoutForm.customerName} onChange={e=>setCheckoutForm({...checkoutForm, customerName: e.target.value})} />
                            <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" placeholder="手機電話 *" value={checkoutForm.phone} onChange={e=>setCheckoutForm({...checkoutForm, phone: e.target.value})} />
                            <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" placeholder="匯款後五碼 *" value={checkoutForm.transferLastFive} onChange={e=>setCheckoutForm({...checkoutForm, transferLastFive: e.target.value})} maxLength={5} />
                            <button onClick={()=>setCheckoutForm({...checkoutForm, hasScreenshot: true})} className={`p-4 border-2 border-dashed rounded-2xl flex items-center justify-center gap-2 font-bold ${checkoutForm.hasScreenshot ? 'border-green-500 text-green-600' : 'border-slate-300 text-slate-400'}`}>
                                <Camera /> {checkoutForm.hasScreenshot ? '匯款截圖已紀錄' : '模擬上傳轉帳截圖'}
                            </button>
                            <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" placeholder="配送地址" value={checkoutForm.address} onChange={e=>setCheckoutForm({...checkoutForm, address: e.target.value})} />
                            <div className="grid grid-cols-2 gap-4">
                                <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" placeholder="發票抬頭" value={checkoutForm.taxTitle} onChange={e=>setCheckoutForm({...checkoutForm, taxTitle: e.target.value})} />
                                <input className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900" placeholder="統一編號" value={checkoutForm.taxId} onChange={e=>setCheckoutForm({...checkoutForm, taxId: e.target.value})} />
                            </div>
                            <textarea className="w-full p-4 bg-white border-2 border-slate-200 rounded-2xl font-bold text-slate-900 h-24" placeholder="備註..." value={checkoutForm.remarks} onChange={e=>setCheckoutForm({...checkoutForm, remarks: e.target.value})} />
                            <button onClick={submitOrder} className="w-full bg-slate-900 text-white py-5 rounded-[2.5rem] font-black text-xl shadow-2xl active:scale-95 transition-all">
                                <Send className="w-5 h-5 inline mr-2" />確認下單付款並通知 LINE
                            </button>
                        </div>
                    </div>
                )}

                {view === 'history' && (
                    <div className="scroll-container p-4 space-y-4">
                        <h2 className="text-2xl font-black text-slate-900 italic tracking-tighter px-2">歷史紀錄與報表</h2>
                        {orders.length === 0 ? (
                            <div className="flex flex-col items-center justify-center py-32 opacity-20">
                                <History className="w-20 h-20 mb-4" />
                                <p className="font-bold uppercase tracking-widest text-xs">尚無訂單紀錄</p>
                            </div>
                        ) : (
                            <div className="space-y-6 pb-32">
                                {orders.map(o => (
                                    <div key={o.id} className="bg-white p-7 rounded-[3rem] border-2 border-slate-200 shadow-lg space-y-5">
                                        <div className="flex justify-between items-start">
                                            <div className="flex-1">
                                                <p className="text-[10px] font-black text-orange-600 mb-1 uppercase tracking-widest">ID: {o.id}</p>
                                                <h3 className="font-black text-slate-900 text-xl leading-tight">{o.companyName || o.customerName}</h3>
                                                <p className="text-[10px] font-bold text-slate-400 mt-2 tracking-widest">{o.date}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className="text-2xl font-black text-slate-900 tracking-tighter">${o.totalAmount}</p>
                                                <span className="text-[9px] font-black text-slate-300 uppercase italic">總額</span>
                                            </div>
                                        </div>
                                        <button onClick={() => exportCSV(o)} className="w-full py-4 bg-slate-100 text-slate-900 rounded-2xl font-black text-xs flex items-center justify-center gap-2 hover:bg-slate-900 hover:text-white transition-all shadow-sm active:scale-95 uppercase tracking-widest">
                                            <FileSpreadsheet className="w-4 h-4" /> 下載 EXCEL 報表
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                )}
            </main>

            {editModal && (
                <div className="fixed inset-0 z-[100] bg-slate-900/90 backdrop-blur-lg flex items-center justify-center p-6">
                    <div className="bg-white w-full max-w-sm rounded-[3.5rem] p-10 space-y-6 shadow-2xl relative">
                        <button onClick={() => setEditModal(null)} className="absolute top-8 right-8 text-slate-400 hover:text-slate-600 transition-colors"><X className="w-7 h-7" /></button>
                        <h3 className="font-black text-2xl text-slate-900 italic tracking-tighter">編輯商品主檔</h3>
                        <div className="space-y-4">
                            <input className="w-full p-4 bg-slate-50 border-2 border-slate-200 rounded-2xl font-bold" placeholder="名稱" value={editModal.name} onChange={e=>setEditModal({...editModal, name: e.target.value})} />
                            <div className="grid grid-cols-2 gap-4">
                                <div className="space-y-1">
                                    <p className="text-[10px] font-black text-orange-600 ml-3 uppercase">批價</p>
                                    <input className="w-full p-4 bg-orange-50 border-2 border-orange-200 rounded-2xl font-black text-orange-600 outline-none" type="number" value={editModal.wholesalePrice} onChange={e=>setEditModal({...editModal, wholesalePrice: Number(e.target.value)})} />
                                </div>
                                <div className="space-y-1">
                                    <p className="text-[10px] font-black text-slate-500 ml-3 uppercase">零售價</p>
                                    <input className="w-full p-4 bg-slate-50 border-2 border-slate-200 rounded-2xl font-bold outline-none" type="number" value={editModal.retailPrice} onChange={e=>setEditModal({...editModal, retailPrice: Number(e.target.value)})} />
                                </div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="space-y-1">
                                    <p className="text-[10px] font-black text-orange-600 ml-3 uppercase">架上</p>
                                    <input className="w-full p-5 bg-orange-600 rounded-3xl font-black text-white shadow-xl text-center" type="number" value={editModal.onShelfCount} onChange={e=>setEditModal({...editModal, onShelfCount: Number(e.target.value)})} />
                                </div>
                                <div className="space-y-1">
                                    <p className="text-[10px] font-black text-slate-500 ml-3 uppercase">總庫存</p>
                                    <input className="w-full p-5 bg-slate-900 rounded-3xl font-black text-white shadow-xl text-center" type="number" value={editModal.stock} onChange={e=>setEditModal({...editModal, stock: Number(e.target.value)})} />
                                </div>
                            </div>
                        </div>
                        <button onClick={()=>{
                            setProducts(prev => {
                                const exists = prev.find(p=>p.id===editModal.id);
                                return exists ? prev.map(p => p.id === editModal.id ? editModal : p) : [...prev, editModal];
                            });
                            setEditModal(null);
                        }} className="w-full py-5.5 bg-orange-600 text-white rounded-[3rem] font-black text-2xl active:scale-95 transition-all">儲存商品變動</button>
                    </div>
                </div>
            )}

            <nav className="bg-white border-t-2 border-slate-200 py-4 pb-10 px-8 flex justify-around items-center shadow-[0_-15px_40px_rgba(0,0,0,0.1)] z-50 shrink-0 rounded-t-[3.5rem]">
                {userRole === 'customer' && <NavButton active={view === 'order'} icon={<LayoutGrid size={24}/>} label="選購" onClick={()=>setView('order')} />}
                {userRole === 'admin' && <NavButton active={view === 'inventory'} icon={<ClipboardCheck size={24}/>} label="盤點" onClick={()=>setView('inventory')} />}
                {userRole === 'admin' && <NavButton active={view === 'line-settings'} icon={<Settings size={24}/>} label="設定" onClick={()=>setView('line-settings')} />}
                {userRole === 'customer' && <NavButton active={view === 'cart' || view === 'checkout'} icon={<ShoppingCart size={24}/>} label="購物車" onClick={()=>setView('cart')} />}
                <NavButton active={view === 'history'} icon={<History size={24}/>} label="紀錄" onClick={()=>setView('history')} />
                <NavButton active={false} icon={<LogOut size={24}/>} label="登出" onClick={()=>{setView('auth'); setUserRole(null); setCart([]); setAuthInput({username:'', password:''});}} />
            </nav>
        </div>
    );
};

const NavButton = ({ active, icon, label, onClick }) => (
    <button onClick={onClick} className={`flex flex-col items-center justify-center transition-all duration-300 ${active ? 'text-orange-600 scale-110' : 'text-slate-400'}`}>
        <div className={`p-4 rounded-3xl transition-all ${active ? 'bg-orange-50' : ''}`}>
            {icon}
        </div>
        <span className={`text-[11px] font-black mt-1.5 uppercase tracking-tighter ${active ? 'opacity-100' : 'opacity-60'}`}>{label}</span>
    </button>
);

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(<App />);
    </script>
</body>
</html>